# fruti-landing-c
Frontend Alternative
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FRUTI — Trazabilidad del lote</title>

  <style>
    :root{
      --bg:#f7f7f8;
      --fg:#0f172a;
      --muted:#6b7280;
      --brand:#eecf30;
      --card:#ffffff;
      --ok:#16a34a;
      --err:#dc2626;
      --line:#e5e7eb;
      --radius-lg:16px;
      --radius-sm:10px;
    }

    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      color:var(--fg);
      background:var(--bg);
      line-height:1.4;
    }

    a{
      color:#1d4ed8;
      text-decoration:none;
    }
    a:hover{text-decoration:underline}

    /* HEADER STICKY */
    header{
      position:sticky;
      top:0;
      z-index:10;
      background:linear-gradient(180deg,#fff,rgba(255,255,255,.9));
      backdrop-filter:blur(6px);
      border-bottom:1px solid var(--line);
    }

    .container{
      max-width:1100px;
      margin:0 auto;
      padding:16px;
    }

    .row{
      display:flex;
      flex-wrap:wrap;
      gap:16px;
    }
    .col{
      flex:1 1 260px;
    }

    /* BRAND / HEADER */
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .logo{
      width:32px;
      height:32px;
      border-radius:8px;
      background:linear-gradient(135deg,var(--brand),#ffd84f);
      box-shadow:0 2px 4px rgba(0,0,0,.1);
    }
    .brand-text-title{
      font-weight:700;
      font-size:clamp(16px,2vw,18px);
      line-height:1.2;
      color:var(--fg);
    }
    .brand-text-sub{
      color:var(--muted);
      font-size:12px;
      line-height:1.3;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      border:1px solid var(--line);
      border-radius:999px;
      background:white;
      font-size:12px;
      color:#475569;
      white-space:nowrap;
    }

    /* SECTION TITLES */
    h1,h2,h3{
      font-weight:600;
      line-height:1.3;
      color:var(--fg);
    }
    h1{
      font-size:clamp(18px,2.5vw,22px);
      margin-bottom:4px;
    }
    h2{
      font-size:16px;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    h3{
      font-size:15px;
      margin-bottom:8px;
    }

    .section-hint{
      font-size:13px;
      color:var(--muted);
      margin-bottom:12px;
      line-height:1.4;
    }

    /* CARDS */
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius-lg);
      padding:16px;
      box-shadow:0 1px 2px rgba(16,24,40,.04);
    }

    .card-compact{
      padding:12px 16px;
    }

    /* INPUTS */
    label{
      font-size:13px;
      font-weight:500;
      color:var(--muted);
      display:block;
      margin-bottom:4px;
    }

    .input{
      width:100%;
      padding:12px 14px;
      border:1px solid var(--line);
      border-radius:var(--radius-sm);
      background:white;
      font-size:14px;
      line-height:1.3;
      color:var(--fg);
    }

    /* BUTTONS */
    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:12px 14px;
      border-radius:var(--radius-sm);
      border:1px solid #d1d5db;
      background:var(--fg);
      color:white;
      font-size:14px;
      font-weight:500;
      line-height:1.2;
      cursor:pointer;
      text-align:center;
      width:100%;
    }
    .btn:disabled{
      opacity:.6;
      cursor:not-allowed;
    }
    .btn.secondary{
      background:white;
      color:var(--fg);
    }

    /* BADGES */
    .badge{
      display:inline-block;
      padding:4px 8px;
      border-radius:999px;
      font-size:12px;
      line-height:1.2;
      border:1px solid transparent;
      font-weight:500;
    }
    .badge.ok{
      background:#ecfdf5;
      color:#065f46;
      border-color:#bbf7d0;
    }
    .badge.err{
      background:#fef2f2;
      color:#991b1b;
      border-color:#fecaca;
    }
    .badge.neutral{
      background:#f1f5f9;
      color:#475569;
      border-color:#cbd5e1;
    }

    /* LOT INFO GRID */
    .info-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      font-size:14px;
    }
    .info-item strong{
      display:block;
      font-weight:600;
      font-size:12px;
      color:var(--muted);
      margin-bottom:2px;
    }
    @media(max-width:480px){
      .info-grid{
        grid-template-columns:1fr;
      }
    }

    /* QR BOX (placeholder) */
    .qr-box{
      width:96px;
      height:96px;
      border-radius:12px;
      border:1px solid var(--line);
      background:repeating-linear-gradient(
        45deg,
        #f8fafc 0 10px,
        #e2e8f0 10px 20px
      );
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:10px;
      font-weight:500;
      color:#475569;
      text-align:center;
      line-height:1.3;
    }

    /* TABLE / MOVIMIENTOS */
    .table-wrapper{
      overflow-x:auto;
      border:1px solid var(--line);
      border-radius:var(--radius-sm);
      background:white;
    }

    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      min-width:640px;
      font-size:13px;
    }
    th,td{
      padding:10px;
      border-bottom:1px solid var(--line);
      text-align:left;
      vertical-align:top;
    }
    th{
      background:#fafafa;
      color:#64748b;
      font-weight:600;
      white-space:nowrap;
      font-size:12px;
    }
    tr:last-child td{
      border-bottom:none;
    }

    /* MOBILE "card rows" view for movimientos:
       En pantallas MUY chicas podemos hacer las filas más legibles
       sin tener que scrollear horizontalmente una tabla gigante.
       Esto se activa sólo si queremos 100% mobile-card. Por ahora
       dejamos la tabla scrollable (más simple para vos de mantener).
       Si queremos modo card, lo podemos habilitar después. */

    /* STATUS AREA */
    #status{
      font-size:13px;
      line-height:1.4;
      min-height:1.4em;
    }
    #status.ok{
      color:var(--ok);
    }
    #status.err{
      color:var(--err);
      font-weight:500;
    }

    /* FOOTER / DEBUG */
    .footer{
      color:#94a3b8;
      font-size:12px;
      margin-top:24px;
      line-height:1.4;
    }

    .debug-card-title{
      font-size:13px;
      font-weight:600;
      color:var(--fg);
      display:flex;
      align-items:center;
      justify-content:space-between;
      cursor:pointer;
      user-select:none;
    }

    .code-block{
      font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      background:#0f172a;
      color:#e5e7eb;
      border-radius:12px;
      padding:12px;
      overflow:auto;
      font-size:12px;
      line-height:1.4;
      margin-top:12px;
    }

    /* SMALL UTILS */
    .flex-between{
      display:flex;
      flex-wrap:wrap;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
    }

    .actions-row{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
    }
    .actions-row .btn{
      flex:1 1 140px;
    }

    .muted-inline{
      font-size:12px;
      color:var(--muted);
      line-height:1.3;
    }

    .hidden{
      display:none;
    }

  </style>
</head>

<body>
  <header>
    <div class="container flex-between" style="align-items:center;">
      <div class="brand" aria-label="FRUTI - trazabilidad de frutas y verduras">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <div class="brand-text-title">FRUTI</div>
          <div class="brand-text-sub">Del campo a tu mesa</div>
        </div>
      </div>

      <div class="pill">
        <span>Versión API</span>
        <span id="apiVersion">v0.6.0</span>
      </div>
    </div>
  </header>

  <main class="container" style="padding-top:18px; padding-bottom:48px;">
    <!--
      CAMBIO: Agrego <h1> accesible.
      Razón: mejora jerarquía semántica y ayuda a lectores de pantalla.
    -->
    <h1>Información del lote</h1>
    <p class="section-hint">
      Escaneaste un lote de fruta / verdura. Acá podés ver de dónde viene.
    </p>

    <!-- STATUS / MENSAJES AL USUARIO -->
    <!--
      CAMBIO: aria-live="polite" para accesibilidad (lectores de pantalla leen cambios).
      Razón: avisos de error/éxito en tiempo real.
    -->
    <div id="status" class="section-hint" role="status" aria-live="polite"></div>

    <!-- INFO DEL LOTE -->
    <!--
      CAMBIO: Se renombraron etiquetas para consumidor final.
      Ej: "Origen (actor)" -> "Productor / Finca".
      "Retailer" -> "Puesto / Verdulería".
      Razón: lenguaje más humano.
    -->
    <section id="lotInfo" class="card" style="display:none; margin-bottom:16px;">
      <div class="flex-between" style="align-items:flex-start;">
        <div style="flex:1 1 auto;">
          <h2>
            Info del lote
            <span class="badge neutral" id="lotCodeTxt">L-XXXX</span>
          </h2>
          <div class="section-hint" style="margin-top:-4px;">
            Datos clave sobre este lote.
          </div>
        </div>

        <!--
          CAMBIO: agrego caja QR visual.
          Razón: el vendedor puede mostrar el QR; más adelante lo generamos dinámicamente.
        -->
        <div class="qr-box" id="qrBox" aria-label="Código QR del lote">
          QR<br/>lote
        </div>
      </div>

      <div class="info-grid" style="margin-top:16px;">
        <div class="info-item">
          <strong>Producto</strong>
          <span id="lotProduct">—</span>
        </div>

        <div class="info-item">
          <strong>Variedad</strong>
          <span id="lotVariety">—</span>
        </div>

        <div class="info-item">
          <strong>Fecha de cosecha</strong>
          <span id="lotHarvest">—</span>
        </div>

        <div class="info-item">
          <strong>Estado del lote</strong>
          <span id="lotStatus" class="badge neutral">—</span>
        </div>

        <div class="info-item">
          <strong>Productor / Finca</strong>
          <span id="lotOrigin">—</span>
        </div>

        <div class="info-item">
          <strong>Puesto / Verdulería</strong>
          <span id="lotRetailer">—</span>
        </div>
      </div>

      <!-- Acciones técnicas -->
      <div style="margin-top:16px;">
        <h3 style="margin-bottom:4px;">Datos técnicos</h3>
        <p class="muted-inline" style="margin-bottom:12px;">
          Para inspección, auditoría o trazabilidad oficial.
        </p>

        <div class="actions-row">
          <a id="csvLink" class="btn secondary" download>Descargar CSV</a>

          <button id="btnCopyJson" class="btn secondary" type="button" onclick="copyJson()">
            Copiar JSON
          </button>
        </div>
      </div>
    </section>

    <!-- MOVIMIENTOS -->
    <!--
      CAMBIO: Sección separada "Movimientos del lote".
      Razón: claridad mental: primero qué es el lote, después su historia.
    -->
    <section id="eventsCard" class="card" style="display:none; margin-bottom:24px;">
      <h2>Movimientos del lote</h2>
      <div class="section-hint" style="margin-top:-4px;">
        Cada paso desde el origen hasta el punto de venta.
      </div>

      <!-- mensaje si no hay eventos -->
      <div id="noEventsMsg" class="section-hint hidden" style="font-style:italic;">
        Sin movimientos registrados todavía.
      </div>

      <div class="table-wrapper" style="margin-top:12px;">
        <table id="eventsTable" aria-label="Historial de movimientos del lote">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Acción</th>
              <th>Quién</th>
              <th>Desde</th>
              <th>Hacia</th>
              <th>Cant.</th>
              <th>Unidad</th>
              <th>Precio</th>
              <th>Moneda</th>
              <th>Notas</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

    </section>

    <!-- BUSCAR OTRO LOTE -->
    <!--
      CAMBIO: en v0.6 esto era lo primero.
      Ahora lo movemos abajo y lo titulamos "Buscar otro lote".
      Razón: caso QR ya tiene datos, y si el usuario quiere ver otro lote lo hace acá.
    -->
    <section class="card card-compact" style="margin-bottom:24px;">
      <h2>Buscar otro lote</h2>
      <p class="section-hint" style="margin-top:-4px;">
        Si querés ver un lote distinto, ingresá el código que figura en la etiqueta.
      </p>

      <div class="row" style="align-items:flex-end;">
        <div class="col">
          <label for="apiBase">Dirección de la API (avanzado)</label>
          <input id="apiBase" class="input" placeholder="http://localhost:8000" value="http://localhost:8000" />
        </div>

        <div class="col">
          <label for="lotCode">Código del lote</label>
          <input id="lotCode" class="input" placeholder="Ej: L-0001" />
        </div>

        <div class="col" style="flex:0 0 160px">
          <button id="btnSearch" class="btn" type="button" onclick="doSearch()">
            Ver información
          </button>
        </div>
      </div>

      <div class="section-hint" style="margin-top:10px;">
        Si no funciona, pedile al vendedor que confirme el código.
      </div>
    </section>

    <!-- DEBUG / DEV INFO -->
    <!--
      CAMBIO: Footer más ordenado y con contexto.
      Razón: separar lo técnico para auditor / inspección sin ensuciar la vista del consumidor.
    -->
    <section class="footer card card-compact" style="border-style:dashed;">
      <div class="debug-card-title" onclick="
        const dbg=document.getElementById('debugBody');
        dbg.classList.toggle('hidden');
      ">
        <span>Detalles técnicos (dev / inspección)</span>
        <span style="font-size:11px;color:var(--muted);">(tocar para ver / ocultar)</span>
      </div>

      <div id="debugBody" class="hidden" style="margin-top:12px;">
        <div style="font-size:12px;line-height:1.4;color:#475569;">
          Endpoints usados:
        </div>

        <div class="code-block" aria-label="Endpoints utilizados">
          /health<br/>
          /trace/{code}<br/>
          /export/lot/{code}.csv
        </div>

        <div style="margin-top:12px;font-size:12px;line-height:1.4;color:#475569;">
          © FRUTI MVP v0.6 — Visualizador público de trazabilidad.
        </div>
      </div>
    </section>
  </main>

  <script>
    // util dom
    const byId = (id)=>document.getElementById(id);

    function fmtDate(x){
      if(!x) return "—";
      const d = new Date(x);
      if(isNaN(d.getTime())) return x;
      return d.toLocaleString();
    }

    function setBadge(el, status){
      // CAMBIO: badge neutral por default si no matchea "activo"/"anulado"
      // Razón: fallback visual más prolijo.
      el.textContent = status || "—";
      let cls = "badge neutral";
      if(status === "activo") cls = "badge ok";
      if(status === "anulado") cls = "badge err";
      el.className = cls;
    }

    async function health(base){
      try{
        const r = await fetch(base + "/health");
        if(!r.ok) return {status:"error"};
        return await r.json();
      }catch(e){
        return {status:"error"};
      }
    }

    async function doSearch(){
      const base = byId("apiBase").value.trim().replace(/\/+$/,"");
      const code = byId("lotCode").value.trim();

      if(!base || !code){
        setStatus("Definí API y código de lote.", "err");
        return;
      }

      byId("btnSearch").disabled = true;
      setStatus("Buscando lote…", ""); // neutral

      const h = await health(base);
      if(h && h.version){
        byId("apiVersion").textContent = h.version;
      }

      try{
        const r = await fetch(`${base}/trace/${encodeURIComponent(code)}`);
        if(!r.ok){
          throw new Error("No pudimos encontrar ese lote. Revisá el código o pedile al vendedor que lo confirme.");
        }
        const data = await r.json();
        renderTrace(base, data);
        setStatus("Listo.", "ok");
      }catch(e){
        setStatus(e.message || "Error desconocido.", "err");
        // ocultar data previa si había
        byId("lotInfo").style.display = "none";
        byId("eventsCard").style.display = "none";
      }finally{
        byId("btnSearch").disabled = false;
      }
    }

    function renderTrace(base, data){
      const lot = data.lot || {};
      const evs = data.events || [];

      // Mostrar sección Info del lote
      byId("lotInfo").style.display = "block";

      // Código del lote
      byId("lotCodeTxt").textContent = lot.code || "—";

      // Info simple
      byId("lotProduct").textContent = lot.product || "—";
      byId("lotVariety").textContent = lot.variety || "—";
      byId("lotHarvest").textContent = fmtDate(lot.harvest_date);
      setBadge(byId("lotStatus"), lot.status);

      // Lenguaje consumidor
      byId("lotOrigin").textContent = lot.origin_actor_id || "—";
      byId("lotRetailer").textContent = lot.retailer_actor_id || "—";

      // CSV link
      const csv = `${base}/export/lot/${encodeURIComponent(lot.code)}.csv`;
      byId("csvLink").href = csv;

      // QR BOX
      // CAMBIO: mostramos el código dentro del QR placeholder
      // Razón: refuerza visualmente que este QR corresponde a ese lote.
      const qrBox = byId("qrBox");
      qrBox.textContent = lot.code ? ("QR\n" + lot.code) : "QR\nlote";

      // Movimientos
      const tbody = byId("eventsTable").querySelector("tbody");
      tbody.innerHTML = "";

      if(!evs.length){
        byId("noEventsMsg").classList.remove("hidden");
      }else{
        byId("noEventsMsg").classList.add("hidden");

        evs.forEach(e => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${fmtDate(e.event_time)}</td>
            <td>${e.event_type || "—"}</td>
            <td>${e.actor_name || "—"}</td>
            <td>${e.from_actor_name || "—"}</td>
            <td>${e.to_actor_name || "—"}</td>
            <td>${(e.quantity ?? "—")}</td>
            <td>${e.unit || "—"}</td>
            <td>${(e.unit_price ?? "—")}</td>
            <td>${e.currency || "—"}</td>
            <td>${e.notes || "—"}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      // Mostrar sección Movimientos
      byId("eventsCard").style.display = "block";

      // Guardamos último trace en memoria para copiar JSON
      window._lastTrace = data;
    }

    function setStatus(msg, kind){
      const st = byId("status");
      st.textContent = msg || "";
      st.className = "section-hint"; // reset
      if(kind === "ok") st.classList.add("ok");
      if(kind === "err") st.classList.add("err");
    }

    async function copyJson(){
      try{
        const txt = JSON.stringify(window._lastTrace || {}, null, 2);
        await navigator.clipboard.writeText(txt);
        setStatus("JSON copiado al portapapeles.", "ok");
      }catch(e){
        setStatus("No se pudo copiar el JSON.", "err");
      }
    }

    // IDEA FUTURA:
    // cuando esta página se sirva en /trace/:code directamente del backend,
    // podemos hacer fetch automático usando ese :code sin que el
    // usuario toque "Buscar otro lote".
    // Eso lo implementamos en la próxima iteración.
  </script>
</body>
</html>
